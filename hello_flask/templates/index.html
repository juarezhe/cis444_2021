<!DOCTYPE html>
<html>

<head>
	<style>
		body {
			margin: 40px;
		}

		.tab {
			float: center;
		}

		.column {
			width: 33%;
			display: inline-block;
		}
		
		.column.center {
			width: 67%;
		}

		.left.inner {
			color: #7e7e7e;
			background: #ffffff;
			border-radius: 0px 0px 11px 0px;
		}

		.left.inner.selected {
			color: black;
			background: #ececec;
			border-radius: 0px 11px 0px 0px;
		}

		.left.outer {
			width: 50%;
			display: inline-block;
			background: #ececec;
		}

		.left.outer.selected {
			border-radius: 0px 11px 0px 0px;
		}

		.right.inner {
			color: #7e7e7e;
			background: #ffffff;
			border-radius: 0px 0px 0px 11px;
		}

		.right.inner.selected {
			color: black;
			background: #ececec;
			border-radius: 11px 0px 0px 0px;
		}

		.right.outer {
			width: 50%;
			display: inline-block;
			background: #ececec;
		}

		.right.outer.selected {
			border-radius: 11px 0px 0px 0px;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.js"
		integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous">
		</script>
</head>

<body>
	<script>
		var token;

		function logout() {
			fetch('/logout');
			token = undefined;
			$('#login_signup_bar').show();
			$('#logout_button').hide();
			$('#item_display').hide();
		}

		async function handleToken() {
			if (token != undefined) {
				const postResponse = await $.post("/validateToken", { "jwt": token.jwt }, function (data, textStatus) { }, "json");
				if (postResponse.data.jwt == token.jwt) {
					$('#login_signup_bar').hide();
					$('#logout_button').show();
					$('#item_display').show();
				}
			}
		}
		async function login_check() {
			if ($('#login_user').val().length == 0) {
				alert("Please enter a username to login.");
				return false;
			}
			if ($('#login_pass').val().length == 0) {
				alert("Please enter a password to login.");
				return false;
			}
			if ($('#login_pass').val().length > 72) {
				alert("Password must be 72 characters or less.");
				return false;
			}
			const postResponse = await $.post("/login",
				{ "username": document.getElementById('login_user').value, "password": document.getElementById('login_pass').value },
				"json");
			if (postResponse.status == 200) {
				token = await postResponse.data;
				await handleToken();
			}
			else {
				alert(postResponse.data.message);
			}
			document.getElementById('login_user').value = "";
			document.getElementById('login_pass').value = "";
			return true;
		}
		async function signup_check() {
			if ($('#signup_user').val().length == 0) {
				alert("Please enter a username to signup.");
				return false;
			}
			if ($('#signup_pass').val().length == 0) {
				alert("Please enter a password to signup.");
				return false;
			}
			if ($('#signup_pass').val().length > 72) {
				alert("Password must be 72 characters or less.");
				return false;
			}
			const postResponse = await $.post("/signup",
				{ "username": document.getElementById('signup_user').value, "password": document.getElementById('signup_pass').value },
				"json");
			alert(postResponse.data.message);
			document.getElementById('signup_user').value = "";
			document.getElementById('signup_pass').value = "";
			return true;
		}
		function switchForm(userAction) {
			if (userAction == "login") {
				$('.right').removeClass('selected');
				$('.left')[0].classList.add('selected')
				$('.left')[1].classList.add('selected')
				$('#login')[0].style.display = "block";
				$('#signup')[0].style.display = "none";
			}
			if (userAction == "signup") {
				$('.left').removeClass('selected');
				$('.right')[0].classList.add('selected')
				$('.right')[1].classList.add('selected')
				$('#login')[0].style.display = "none";
				$('#signup')[0].style.display = "block";
			}
		}
	</script>

	<div style="text-align:center">
		<div id="logout_button" style="float:right; display: none;" onclick="logout();"><button>Logout</button></div><br />
		<h1>Welcome to the bookstore!</h1>

		<div id="item_display" style="background:#ECECEC; display: none;">
			<div class="column center">Title</div><div class="column">Price</div>
			<div>Books will be displayed here.</div>
		</div>

		<div id="login_signup_bar" style="float:right; background:#ECECEC;">
			<div style="background:#FFFFFF">
				<div class="left outer selected" onclick="switchForm('login')"><div class="left inner selected">Login</div></div><div class="right outer" onclick="switchForm('signup')"><div class="right inner">Sign up</div></div>
			</div>

			<div id="login" class="action">
				<h2 style="text-align:center">Login</h2>
				<label for="login_user">Username:</label> <input type="text" id="login_user" name="login_user"
					required><br>
				<label for="login_pass" style="text-align:left">Password:</label> <input type="password"
					id="login_pass" name="login_pass" value="" style="float:right;" required><br><br>
				<input type="submit" value="Login" onclick="return login_check();" style="float:right;">
			</div>

			<div id="signup" class="action" style="display:none">
				<h2 style="text-align:center">Sign up</h2>
				<label for="signup_user">Username:</label> <input type="text" id="signup_user" name="signup_user"
					required><br>
				<label for="signup_pass" style="text-align:left">Password:</label> <input type="password"
					id="signup_pass" name="signup_pass" value="" style="float:right;" required><br><br>
				<input type="submit" value="Sign up" onclick="return signup_check();" style="float:right;">
			</div>
		</div>
	</div>
</body>

</html>