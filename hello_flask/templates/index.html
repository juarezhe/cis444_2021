<!DOCTYPE html>
<html>

<head>
	<style>
		body {
			margin: 40px;
		}

		.tab {
			float: center;
		}

		.left.inner {
			color: #7e7e7e;
			background: #ffffff;
			border-radius: 0px 0px 11px 0px;
		}

		.left.inner.selected {
			color: black;
			background: #ececec;
			border-radius: 0px 11px 0px 0px;
		}

		.left.outer {
			width: 50%;
			display: inline-block;
			background: #ececec;
		}

		.left.outer.selected {
			width: 50%;
			display: inline-block;
			background: #ececec;
			border-radius: 0px 11px 0px 0px;
		}

		.right.inner {
			color: #7e7e7e;
			background: #ffffff;
			border-radius: 0px 0px 0px 11px;
		}

		.right.inner.selected {
			color: black;
			background: #ececec;
			border-radius: 11px 0px 0px 0px;
		}

		.right.outer {
			width: 50%;
			display: inline-block;
			background: #ececec;
		}

		.right.outer.selected {
			width: 50%;
			display: inline-block;
			background: #ececec;
			border-radius: 11px 0px 0px 0px;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.js"
		integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous">
		</script>
</head>

<body onload="handleToken()">
	<script>
		var token;

		async function handleToken() {
			const getResponse = await fetch('/fetchToken');
			var message = await getResponse.json();
			if (message.data.jwt) {
				token = message.data;
			}

			if (token != undefined) {
				const postResponse = await $.post("/validateToken", { "jwt": token.jwt }, function (data, textStatus) { }, "json");
				if (postResponse.data.jwt == token.jwt) {
					$('#login_signup_bar').hide();
					$('#item_display').show();
				}
			}
		}
		function login_check() {
			if ($('#login_pass').val().length > 72) {
				alert("Password must be 72 characters or less.");
				return false;
			}
			return true;
		}
		function signup_check() {
			if ($('#signup_pass').val().length > 72) {
				alert("Password must be 72 characters or less.");
				return false;
			}
			return true;
		}
		function switchForm(userAction) {
			if (userAction == "login") {
				$('.right').removeClass('selected');
				$('.left')[0].classList.add('selected')
				$('.left')[1].classList.add('selected')
				$('#login')[0].style.display = "block";
				$('#signup')[0].style.display = "none";
			}
			if (userAction == "signup") {
				$('.left').removeClass('selected');
				$('.right')[0].classList.add('selected')
				$('.right')[1].classList.add('selected')
				$('#login')[0].style.display = "none";
				$('#signup')[0].style.display = "block";
			}
		}
	</script>

	<div style="text-align:center">
		<h1>Welcome to the bookstore!</h1>

		<div id="item_display" style="background:#ECECEC; display: none;">
			Books will be displayed here.
		</div>

		<div id="login_signup_bar" style="float:right; background:#ECECEC;">
			<div style="background:#FFFFFF">
				<div class="left outer selected" onclick="switchForm('login')"><div class="left inner selected">Login</div></div><div class="right outer" onclick="switchForm('signup')"><div class="right inner">Sign up</div></div>
			</div>

			<div id="login" class="action">
				<h2 style="text-align:center">Login</h2>
				<form action="/login" method="post">
					<label for="login_user">Username:</label> <input type="text" id="login_user" name="login_user"
						required><br>
					<label for="login_pass" style="text-align:left">Password:</label> <input type="password"
						id="login_pass" name="login_pass" value="" style="float:right;" required><br><br>
					<input type="submit" value="Login" onclick="return login_check();" style="float:right;">
				</form>
			</div>

			<div id="signup" class="action" style="display:none">
				<h2 style="text-align:center">Sign up</h2>
				<form action="/signup" method="post">
					<label for="signup_user">Username:</label> <input type="text" id="signup_user" name="signup_user"
						required><br>
					<label for="signup_pass" style="text-align:left">Password:</label> <input type="password"
						id="signup_pass" name="signup_pass" value="" style="float:right;" required><br><br>
					<input type="submit" value="Sign up" onclick="return signup_check();" style="float:right;">
				</form>
			</div>
		</div>
	</div>
</body>

</html>