<!DOCTYPE html>
<html>

<head>
	<style>
		body {
			margin: 40px;
		}

		.tab {
			float: center;
		}

		.tab div {
			background: #FFFFFF;
		}

		.tab div.selected {
			background: #ECECEC;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.js"
		integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous">
		</script>
</head>

<body onload="checkToken()">
	<script>
		var token;

		function checkToken() {
			if (token == undefined) {
				console.log("Token value: " + token);
				$.getJSON("/fetchToken", function (json) {
					console.log(json.jwt);
					token = json.jwt;
					console.log(token);
					appendToken();
				})
			}
		}
		function appendToken() {
			var url = new URL(window.location.href);
			var params = new URLSearchParams(url.search);

			if (params.get('jwt') == null && token != null) {
				params.append('jwt', token);
				url = new URL(url.toString() + "?" + params.toString());
				console.log(url.toString());
				//window.location.href = url;
			}
		}
		function login_check() {
			if ($('#login_pass').val().length > 72) {
				alert("Password must be 72 characters or less.");
				return false;
			}
			return true;
		}
		function signup_check() {
			if ($('#signup_pass').val().length > 72) {
				alert("Password must be 72 characters or less.");
				return false;
			}
			return true;
		}
		function openUserAction(element, userAction) {
			$("div").removeClass("selected");
			element.classList.add("selected");

			var i;
			var x = document.getElementsByClassName("action");
			for (i = 0; i < x.length; i++) {
				x[i].style.display = "none";
			}
			document.getElementById(userAction).style.display = "block";
		}
	</script>

	<div style="text-align:center">
		<h1>Welcome to the bookstore!</h1>

		<div style="float:right; background:#ECECEC;">
			<div class="tab" style="background:#FFFFFF">
				<div class="selected" style="width:50%; display:inline-block; border-radius: 0px 10px 0px 0px;"
					onclick="openUserAction(this, 'login')">
					Login</div><div style="width:50%; display:inline-block; border-radius: 10px 0px 0px 0px;"
					onclick="openUserAction(this, 'signup')">Sign up</div>
			</div>

			<div id="login" class="action">
				<h2 style="text-align:center">Login</h2>
				<form action="/login" method="post">
					<label for="login_user">Username:</label> <input type="text" id="login_user" name="login_user"
						required><br>
					<label for="login_pass" style="text-align:left">Password:</label> <input type="password"
						id="login_pass" name="login_pass" value="" style="float:right;" required><br><br>
					<input type="submit" value="Login" onclick="return login_check();" style="float:right;">
				</form>
			</div>

			<div id="signup" class="action" style="display:none">
				<h2 style="text-align:center">Sign up</h2>
				<form action="/signup" method="post">
					<label for="signup_user">Username:</label> <input type="text" id="signup_user" name="signup_user"
						required><br>
					<label for="signup_pass" style="text-align:left">Password:</label> <input type="password"
						id="signup_pass" name="signup_pass" value="" style="float:right;" required><br><br>
					<input type="submit" value="Sign up" onclick="return signup_check();" style="float:right;">
				</form>
			</div>
		</div>
	</div>
</body>

</html>